# 6. HTTP 헤더

우리가 평소 웹사이트를 이용할 때는 볼 수 없지만, HTTP의 리퀘스트와 리스폰스에는 반드시 HTTP 헤더가 포함되어 있다. 



# HTTP 메시지 헤더

HTTP 프로토콜의 리퀘스트와 리스폰스에는 반드시 메시지 헤더가 포함되어 있는데, 메시지 헤더에는 클라이언트나 서버가 리퀘스트/리스폰스를 처리하기 위한 정보가 들어있다. 이러한 정보는 사용자가 직접 볼 필요는 없기 때문에 우리가 평소 웹사이트를 이용할 때는 알 수 없다.   


메시지 헤더의 요소로는 몇가지가 있다.  

**리퀘스트의 HTTP 메시지**

`메소드, URI, HTTP 버전, HTTP 헤더 필드` 등으로 구성된다.



**리스폰스의 HTTP 메시지**

`HTTP 메시지, HTTP 버전, 상태 코드(+설명), HTTP 헤더 필드` 등으로 구성된다.   


※ HTTP 헤더 필드에는 가장 다양한 정보가 들어있다. 헤더 필드는 리퀘스트와 리스폰스 양쪽 모두에 존재하는데, HTTP 메시지에 관한 정보를 담고 있다.



# HTTP 헤더 필드

HTTP 헤더 필드는 프로토콜 중 클라이언트-서버 통신에서 리퀘스트, 리스폰스 둘 다에 사용되며, 부가적으로 중요한 정보를 전달하는 역할을 한다. 그리고 메시지 바디의 크기나 사용하고 있는 언어, 인증 정보 등을 브라우저나 서버에 제공하기 위해 사용된다.   



## HTTP 헤더 필드의 구조

```html
헤더 필드 : 필드 값     
```

하나의 HTTP 헤더 필드가 여러 개의 필드 값을 가질 수도 있다.   



※ HTTP 헤더 필드가 중복됐을 때는?

메시지 헤더 중에 같은 헤더 필드 이름이 둘 이상 있다면 명확한 규정이 있는 것이 아니기 때문에 브라우저에 따라 다르게 동작하게 된다. 어떤 브라우저는 최초의 헤더 필드를 우선적으로, 어떤 브라우저는 마지막 헤더 필드를 우선적으로 처리한다.



## 헤더 필드의 종류

- 일반적 헤더 필드(General Header Fields)
    - 리퀘스트 메시지와 리스폰스 메시지 둘 다에 사용되는 헤더
- 리퀘스트 헤더 필드(Request Header Fields)
    - 클라이언트 측에서 서버 측으로 보낸 리퀘스트 메시지에 사용되는 헤더. 리퀘스트의 부가적 정보와 클라이언트의 정보, 리스폰스의 콘텐츠에 관한 우선순위 등을 부가한다.
- 리스폰스 헤더 필드(Response Header Fields)
    - 서버 측에서 클라이언트 측으로 보낸 리스폰스 메시지에 사용되는 헤더. 리스폰스의 정보와 서버의 정보, 클라이언트의 추가 정보 요구 등을 부가한다.
- 엔티티 헤더 필드(Entity Header Fields)
    - 리퀘스트 메시지와 리스폰스 메시지에 포함된 엔티티에 사용되는 헤더. 콘텐츠 갱신 시간 등 엔티티에 관한 정보를 부가한다.


HTTP/1.1 헤더 필드의 종류는 다음 표를 참고한다.

(((((표)))))

※ End-to-end 헤더와 Hop-to-hop 헤더

- End-to-end 헤더 : 리퀘스트카 리스폰스의 최종 수신자에게 전송된다.
- Hop-to-hop 헤더 : 1회 전송에 대해서만 유효하고 캐시와 프록시에 의해서 전송되지 않는 것도 있다.


### 일반 헤더 필드

일반 헤더 필드는 리퀘스트 메시지와 리스폰스 메시지 양쪽에서 사용되는 헤더이다.



**Cache-Control**

- `디렉티브`라는 명령을 사용하여 캐싱 동작을 지정한다.
- 캐시 가능 여부를 나타내는 디렉티브
    - public
    - private
    - no-cache
- 캐시로 보존 가능한 것을 제어하는 디렉티브
    - no-store
- 캐시 기한이나 검증을 지정하는 디렉티브
    - s-maxage
    - max-age
    - min-fresh
- 캐시가 만료되었을 때의 디렉티브
    - max-stale
    - only-if-cached
    - must-revalidate
    - proxy-revalidate
    - no-transform
- Cache-Control 확장
    - cache-extension 토큰



**Connection**

- 프록시에 더 이상 전송하지 않는 헤더 필드(hop-by-hop)를 지정한다.
- 지속적 접속을 관리한다.
    - HTTP/1.1에서는 지속적 접속이 기본이다. 확실하게 접속을 끊고싶다면 Connection 헤더필드에 `Close`라고 지정한다.
    - HTTP/1.1 이전 버전에서는 지속적 접속을 설정하고 싶다면 Connection 헤더 필드에 `Keep-Alive`라고 지정해야 한다.



**Date**

- HTTP 메시지를 생성한 날짜를 나타낸다.



**Pragma**

- HTTP/1.1 보다 오래된 버전의 흔적으로, HTTP/1.0 과의 후방 호환성만을 위해 정의되어 있는 헤더 필드이다.
- Pragma : no-cache 형식으로만 지정할 수 있다.
- 일반 헤더 필드이지만 클라이언트의 리퀘스트에서만 사용된다.



**Trailer**

- 메시지 바디의 뒤에 기술되어 있는 헤더 필드를 미리 전달할 수 있다.
- HTTP/1.1 에 구현되어 있는 청크 전송 인코딩을 사용하고 있는 경우에 사용 가능하다.



**Transfer-Encoding**

- 메시지 바디의 전송 코딩 형식을 지정할 때 사용된다.
- HTTP/1.1 에서의 전송 코딩 형식으로 청크 전송만이 정의되어 있다.



**Upgrade**

- HTTP 및 다른 프로토콜의 새로운 버전이 통신에 이용되는 경우에 사용된다. 지정하는 대상이 전혀 다른 통신 프로토콜이더라도 상관없다.



**Via**

- 클라이언트와 서버 간의 리퀘스트 혹은 리스폰스 메시지의 경로를 알기 위해 사용된다.
- 전송된 메시지의 추적과 리퀘스트 루프의 회피 등에 사용되기 때문에 프록시를 경유하는 경우 반드시 부가해야 한다.



**Warning**

- 리스폰스에 관한 추가 정보를 전달한다. 기본적으로 캐시에 관한 경고를 유저에게 전달한다.


```html
Warning: [경고 코드][경고한 호스트:포트 번호]"[경고문]"([날짜])
※ 날짜는 생략 가능하다
```


# 리퀘스트 헤더 필드

클라이언트 측에서 서버 측으로 송신된 리퀘스트 메시지에 사용되는 헤더이다. 리퀘스트의 부가 정보와 클라이언트의 정보, 리스폰스의 콘텐츠에 관한 우선 순위 등을 추가한다.



## Accept

유저 에이전트에 처리할 수 있는 미디어 타입과 미디어 타입의 상대적인 우선순위를 전달하기 위해 사용된다. 미디어 타임의 지정은 '타입/서브 타입'으로 한번에 지정할 수도 있다.


다음은 미디어 타입의 종류이다

- 텍스트 파일(text/html, text/css, applicaton/xhtml+xml, ...)
- 이미지 파일(image/jpeg, image/gif, ...)
- 동영상 파일(video/mpeg, video/quicktime, ...)
- 애플리케이션용 바이너리 파일(application/octet-stream, application-zip, ...)



## Accept-Charset


유저 에이전트에서 처리할 수 있는 여러 문자셋을 제공한다. 콘텐츠 네고시에이션을 통해 서버가 제안된 것들 중 문자셋을 하나 선택하고 클라이언트에게 그것을 알려준다. 

Accept 헤더필드와 마찬가지로, 품질 지수에 의해 상대적 우선 순위를 표시한다. 서버 구동형 네고시에이션에 이용된다.



## Accept-Encoding

유저 에이전트가 처리할 수 있는 콘텐츠 코딩과 콘텐츠 코딩의 상대적인 우선순위를 전달하기 위해 사용된다. 한 번에 여러 개를 지정할 수 있다.



**콘텐츠 코딩의 종류**

- gzip
- compress
- deflate
- identity



## Accept-Language

유저 에이전트가 처리할 수 있는 자연어 세트(한-영)와 자연어 세트의 상대적인 우선순위를 전달하기 위해 사용된다. 자연어 세트는 한번에 여러개를 지정할 수 있다.

Accept 헤더 필드와 같이 품질 지수에 의해 상대적인 우선순위를 나타낸다.



## Authorization

유저 에이전트의 인증 정보(credential 값)을 전달하기 위해 사용된다. 일반적으로 서버에 인증을 받으려 하는 유저 에이전트는 상태 코드 401 리스폰스의 뒤 리퀘스트에 Authorization 헤더 필드를 포함한다.



## Expect

클라이언트가 서버에 특정 동작 요구를 전달한다. 기대하는 요구에 서버가 응답하지 못하는 경우에는 상태 코드 `417 Expectation Failed` 를 반납한다. 



## From

유저 에이전트를 사용하고 있는 유저의 메일 주소를 전달한다. 일반적으로 검색 엔진 등의 에이전트 책임자의 연락처나 메일 주소를 나타내는 목적이다.

에이전트를 사용하고 있는 경우에는 되도록 From 헤더 필드를 포함해야 한다.



## Host

리퀘스트한 리소스의 인터넷 호스트와 포트 번호를 전달한다. HTTP/1.1 에서 유일한 필수 헤더 필드이다.

리퀘스트가 서버에 오면 호스트 명을 IP 주소로 해결해 리퀘스트가 처리된다. 이 때 같은 IP 주소로 복수의 도메인이 적용되어 있다고 한다면 어느 도메인에 대한 리퀘스트인지 알 수 없기 때문에 Host 헤더 필드에 리퀘스트를 받을 호스트명을 명확하게 해둘 필요가 있다.



## If-Match

`If-xxx` 헝태의 리퀘스트 헤더 필드는 조건부 리퀘스트라고 한다. 조건부 리퀘스트를 받은 서버는 지정된 조건에 맞는 경우에만 리퀘스트를 받는다. 

조건부 리퀘스트의 하나인 If-Match 헤더 필드는 서버 상의 리소스를 특정하기 위해서 엔티티 태그(ETag)값을 전달한다. 이 때 서버는 약한 ETag 값을 사용할 수 없고, If-Match의 필드 값과 리소스의 ETag 값이 일치한 경우에만 리퀘스트를 받아들일 수 있다.



## If-Modified-Since

조건부 리퀘스트의 하나로, 리소스 갱신 날짜가 필드 값보다 최신이 아니라면 리퀘스트를 받아들이겠다는 의미를 가진다. 필드 값이 지정된 날짜 이후에 지정한 리소스가 갱신되어 있지 않다면 상태 코드 `304 Not Modified` 리스폰스를 반환한다.



## If-None-Match

조건부 리퀘스트의 하나로, If-Match 헤더 필드와 반대로 동작한다. If-None-Match 필드 값에 지정된 엔티티 태그(ETag) 값이 지정된 리소스의 ETag 값과 일치하지 않으면 리퀘스트를 받아들이겠다는 의미이다. 



## If-Range

조건부 리퀘스트의 하나로, If-Range로 지정한 필드값(ETag 값, 혹은 날짜 지정)과 지정한 리소스의 ETag 값 혹은 날짜가 일치하면 Range 리퀘스트로 처리하고 싶다는 것을 전달한다. 일치하지 않는 경우에는 리소스 전체를 반환한다.



## If-Unmodified-Since

If-Modified-Since 헤더 필드와 반대로 동작한다. 지정된 리소스가 필드 값에 지정된 날짜 이후에 갱신되어 있지 않은 경우에만 리퀘스트를 받아들인다. 



## Max-Forwards

TRACE 혹은 OPTIONS 메소드에 의한 리퀘스트를 할 때 전송해도 좋은 서버 수의 최대치를 10진수 정수로 지정한다. 그리고 서버는 다음 서버에 리퀘스트를 전송할 때 Max-Forwards 값에서 1을 빼서 다시 세트한다. Max-Forwards 값이 0인 경우에는 리스폰스를 반환할 필요가 없다.



## Proxy-Authrization

프록시 서버에서의 인증 요구를 받아들인 때에 인증에 필요한 클라이언트의 정보를 전달한다.

클라이언트 서버의 HTTP 액세스 인증과 비슷하지만 `Proxy-Authrization`은 클라이언트와 프록시 사이에 인증이 이루어진다. 



## Range

리소스의 일부분만 취득하는 Range 리퀘스트를 할 때 지정 범위를 전달한다. 

Range 헤더 필드가 달린 리퀘스트를 받아들인 서버가 리퀘스트를 처리할 수 있을 때는 상태 코드 `206 Partial Content`를, 받아들일 수 없을 때는 `200 OK` 리스폰스로 리소스 전체를 반환한다.



## Referer

리퀘스트가 발생한 본래 리소스의 URI를 전달한다. 기본적으로는 Referer 헤더 필드가 보내져야 하지만, 브라우저의 주소창에 직접 URI를 입력한 경우와 보안상으로 바람직하지 않다고 판단되는 경우에는 보내지 않아도 된다.



## TE

리스폰스로 받을 수 있는 전송 코딩의 형식과 상대적인 우선순위를 전달한다. Accept-Encoding과 매우 유사하지만 여기서는 전송 코딩에 적용된다.



## User-Agent

리퀘스트를 생성한 브라우저와 유저 에이전트의 이름 등을 전달하기 위한 필드이다.




# 리스폰스 헤더 필드

리스폰스 헤더 필드는 서버 측으로부터 클라이언트 측으로 송신되는 리스폰스 메시지에 적용된 헤더로, 리스폰스의 부가 정보나 서버의 정보, 클라이언트에 부가 정보 요구 등을 나타낸다.



## Accept-Ranges

서버가 리소스의 일부분만 지정해서 취득할 수 있는 Range 리퀘스트를 접수할 수 있는지 여부를 전달한다. 지정 가능한 필드값은 2개이며 수신 가능한 경우에는 'bytes', 수신 불가능한 경우에는 'none'이라고 기록한다.



## Age

얼마나 오래 전에 오리진 서버에서 리스폰스가 생성되었는지를 전달한다. 필드 값의 단위는 초이다. 

리스폰스한 서버가 캐시 서버라면 캐시된 리스폰스가 다시 검사된 때부터 검증한 시간이 된다. 프록시가 리스폰스를 생성했다면 Age 헤더 필드는 필수이다.



## ETag

ETag 헤더 필드는 엔티티 태그라고 불리며 리소스를 특정하기 위한 문자열을 전달한다. 서버는 리소스마다 ETag값을 할당한다. 

리소스가 갱신되면 ETag 값도 갱신이 필요하다. 



- 강력한 ETag

    - 엔티티가 아주 조금 다르더라도 반드시 값은 변화한다.



- 약한 ETag

    - 리소스가 같다는 것만을 나타낸다. 의미가 다른 리소스로 그 차이가 있는 경우에만 ETag 값이 변화한다. 값의 앞부분에 `W/` 가 붙는다.



## Location

리스폰스의 수신자에 대해서 Request-URI 이외의 리소스 액세스를 유도하는 경우에 사용된다.

대부분의 브라우저에서는 Location 헤더 필드를 포함한 리스폰스를 받으면 강제로 리다이렉트 하는 곳의 리소스에 액세스를 시도한다.



## Proxy-Authenticate

프록시 서버에서의 인증 요구를 클라이언트에 전달한다. 클라이언트 서버와의 HTTP 액세스 인증과 다른 점은 클라이언트와 프록시 사이에서 인증이 이루어진다는 점이다. 클라이언트와 서버의 경우에는 WWW-Authorization 헤더 필드와 같은 역할을 한다.



## Retry-After

클라이언트가 일정 시간 후에 리퀘스트를 다시 시행해야 하는지를 전달한다. 

주로 상태 코드 `3xx Redirect` 리스폰스와 함께 사용된다.



## Server

서버에 설치되어 있는 HTTP 서버의 소프트웨어를 전달한다. 단순히 서버의 소프트웨어 명칭만이 아닌, 버전이나 옵션에 대해서도 기재하는 경우가 있다.



## Vary

캐시를 컨트롤하기 위해 사용된다. 오리진 서버가 프록시 서버에 로컬 캐시를 사용하는 방법에 대한 지시를 전달한다.

오리진 서버로부터 Vary에 지정되었던 리스폰스를 받아들인 프록시 서버는 이후 캐시된 때의 리퀘스트와 같은 Vary에 지정되어 있는 헤더 필드를 가진 리퀘스트에 대해서만 캐시를 반환할 수 있다.



## WWW-Authenticate

HTTP 헤더 인증에 사용된다. Request-URI 에 지정했던 리소스에 적용할 수 있는 인증 스키마(Basic or Digest)와 파라미터를 나타내는 challenge를 전달한다. 

WWW-Authenticate 헤더 필드는 상태 코드 `401 Unauthorized` 리스폰스에 반드시 포함된다. 



# 엔티티 헤더 필드

리퀘스트 메시지와 리스폰스 메시지에 포함된 엔티티에 사용되는 헤더로 콘텐츠의 갱신 시간 같은 엔티티에 관한 정보를 포함한다.



## Allow

Request-URI에 지정된 리소스가 제공하는 메소드의 일람을 전달한다. 서버가 받을 수 없는 메소드를 수신한 경우에는 상태 코드 405 Method Not Allowed 리스폰스와 함께 수신 가능한 메소드의 일람을 기술한 Allow 헤더 필드를 반환한다.



## Content-Encoding

서버가 엔티티 바디에 대해서 실시한 콘텐트 코딩 형식을 전달한다. 콘텐츠 코딩은 엔티티의 정보가 누락되지 않도록 압축할 것을 지시한다.

- Gzip
- Compress
- Deflate
- Identity



## Content-Language

엔티티 바디에 사용된 자연어(한국어 or 영어)를 전달한다.



## Content-Length

엔티티 바디의 크기(단위: byte)를 전달한다. 엔티티 바디에 전송 코딩이 실시된 경우에는 Content-Language 헤더 필드는 사용해서는 안된다.


## Content-Location

메시지 바디에 대응하는 URI를 전달한다. 

Location 헤더 필드와는 달리 Content-Location은 메시지 바디로 반환된 리소스의 URI를 나타낸다.


## Content-MD5

메시지 바디가 변경되지 않고 도착했는지 확인하기 위해 MD5 알고리즘에 의해서 생성된 값을 전달한다. 유효성을 확인하기 위해서는 수신한 클라이언트 측에서 메시지 바디에 같은 MD5 알고리즘을 실행한다. 이렇게 해서 도출한 값과 필드 값을 비교하여 메시지 바디가 올바른지 여부를 알 수 있다.

단, 이 방법으로는 악의를 가지고 MD5도 재계산한 변조는 검출해낼 수 없다. 



## Content-Range

범위를 지정해서 일부분만을 리퀘스트하는 Range 리퀘스트에 대해서 리스폰스를 할 때 사용된다. 리스폰스로 보낸 엔티티가 어느 부분에 해당하는가를 전달한다. 필드 값에는 현재 보내고 있는 곳을 바이트로 지정한 범위와 전체 사이즈를 기록한다.



## Content-Type

엔티티 바디에 포함되는 오브젝트의 미디어 타입을 전달한다. Accept 헤더 필드와 같이 필드 값은 `타입/서브타입` 으로 기록한다.



## Expires

리소스의 유효 기한 날짜를 전달한다. 캐시 서버가 Expires 헤더 필드를 포함한 리소스를 수신한 경우 필드 값으로 지정된 날짜까지 리스폰스의 복사본을 유지하고 리퀘스트에는 캐시로 응답한다. 

0과 같이, 유효하지 않은 날짜는 과거의 시간을 나타내어 이미 리소스가 만료되었음을 나타낸다.



## Last-Modified

리소스가 마지막으로 갱신되었던 날짜 정보를 전달한다. 기본적으로는 Request-URI가 지정된 리소스가 갱신되었던 날짜가 되지만, CGI 등의 스크립트로 동적인 데이터를 다룰 경우, 그 데이터의 최종 갱신 날짜가 되는 경우도 있다.



# 쿠키를 위한 헤더 필드

쿠키는 사용자 식별과 상태 관리에 사용되는 기능이다. 웹 사이트가 유저의 상태를 관리하기 위해서 웹 브라우저를 경유하여 유저의 컴퓨터에 일시적으로 데이터를 기록해 두고, 다음에 그 유저가 웹 사이트에 액세스 했을 때 지난번에 발행한 쿠키를 송신받을 수 있다.   



## Set-Cookie

상태 관리 개시를 위한 쿠키 정보(리스폰스)

**필드 속성**

- Expires
    - 브라우저가 쿠키를 송출할 수 있는 유효 기한을 지정할 수 있다.
    - 한번 서버에 송출한 클라이언트의 쿠키는 서버에서 명시적으로 삭제할 수 없으므로 유효 기한이 지났다면 쿠키를 덮어 쓴느 것으로 실질적인 클라이언트 쿠키를 삭제하는 것이 가능하다.
- Path
    - 쿠키를 송출하는 범위를 특정 디렉토리에 한정할 수 있다. 그러나 보안 효과는 기대할 수 없다.
- Domain
    - 쿠키의 domain 속성에 의해 지정된 도메인 명은 후방 일치가 된다. 그렇기에 명시적으로 여러 도메인에 대해 쿠키를 송출하는 경우를 제외하고 domain 속성은 지정하지 않는 것이 안전하다.
- Secure
    - 쿠키의 Secure 속성은 웹 페이지가 HTTPS 에서 열렸을 때만 쿠키 송출을 제한하기 위해 지정한다.
    - Secure 속성을 생략한 경우에는 HTTP와 HTTPS 에서도 쿠키를 반송한다.
- HttpOnly 속성
    - 자바스크립트를 경유해서 쿠키를 취득하지 못하도록 하는 쿠키의 확장 기능이다.
    - XSS로부터 쿠키의 도청을 막는 것을 목적으로 한다.



## Cookie

서버에서 수신한 쿠키 정보(리퀘스트)

클라이언트가 HTTP의 상태 관리 지원을 원할 때 서버로부터 수신한 쿠키를 이후의 리퀘스트에 포함해서 전달한다. 



# 기타 헤더 필드

HTTP 헤더 필드는 독자적으로 확장할 수 있다. 

자주 사용되는 헤더 필드가 있다.

- X-Frame-Option
    - 다른 웹사이트의 프레임에서 표시를 제어하는 HTTP 리스폰스 헤더.
    - 클릭 재킹(Click Jacking)이라는 공격을 막는 것을 목적으로 한다.
    - DENY, SAMEORIGIN 값을 지정할 수 있다.
- X-XSS-Protection
    - XSS 대책으로서, 브라우저의 XSS 보호 기능을 제어하는 HTTP 리스폰스 헤더이다.
    - 0: XSS 필터를 무효로 한다, 1: XSS 필터를 유효로 한다.
- DNT
    - Do Not Track 라는 뜻이며, 개인 정보 수집을 거부하는 의사를 나타내는 HTTP 리퀘스트 헤더이다.
    - 타깃 광고 등에 이용되는 트래킹의 거부 의사를 나타내기 위한 방법 중 하나이다.
    - 0: 트래킹 동의, 1: 트래킹 거부
- P3P
    - 웹 사이트 상의 프라이버시 정책에 P3P를 사용하는 것으로, 프로그램이 읽을 수 있는 형태로 나타내기 위한 HTTP 리스폰스 헤더이다.
    - 수순-1 : P3P 정책 작성
    - 수순-2 : P3P 정책 참조 파일을 작성하여 `/w3c/p3p.xml`에 배치
    - 수순-3 : P3P 정책으로부터 콤팩트 정책을 작성하고 HTTP 리스폰스 헤더에 출력